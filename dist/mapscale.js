!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jsdom")):"function"==typeof define&&define.amd?define(["jsdom"],e):"object"==typeof exports?exports.MapScale=e(require("jsdom")):t.MapScale=e(t.jsdom)}(global,(function(t){return function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";const a=i(1),n=i(2),s=i(3),h=i(4);t.exports=class extends h{constructor(t,{dpi:e=96,segmentNum:i=4,fontSize:s=12}={}){if(super(),t<0)return void console.error(new Error("比例尺数值需要大于0！"));this.initialScaleValue=t;const h=n.adjustScaleValue(this.initialScaleValue),o=n.cmUnit(h);this.scaleValue=o.value,this.unit=o.unit,this.dpi=e,this.segmentNum=i,this.fontSize=Math.round(a.calculateVal(e,s)),this.singleSegmentPixelWH=a.calculateWH(e,1,h/this.initialScaleValue),this.canvasWidth=this.singleSegmentPixelWH.width*this.segmentNum,this.canvasHeight=this.singleSegmentPixelWH.height*this.segmentNum,this.barPadding={top:0,right:0,bottom:0,left:0},this.initCtx(this.canvasWidth,this.canvasHeight);const r=this._getTextPixelWH(),c=Math.ceil(a.calculateVal(e,2));this.canvasWidth=this.canvasWidth+r.width,this.canvasHeight=this.canvasHeight+r.height+c,this.setCanvasWH(this.canvasWidth,this.canvasHeight),this.initLayer(),this._drawText(),this._addTextToCanvas(),this.barPadding.top=this.barPadding.top+c,this._drawBar(),this._addBarToCanvas()}_getTextPixelWH(){const t={width:0,height:this.fontSize};return t.width=Math.ceil(this.ctx.measureText(n.cmUnit(this.scaleValue).value+n.cmUnit(this.scaleValue).unit).width),t}getCanvasWH(){return{canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight}}setCanvasWH(t,e){this.canvas.width=t,this.canvas.height=e}initCtx(t,e){this.canvas=this.document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d")}initLayer(){const t=this.document.createElement("canvas");t.width=this.canvasWidth,t.height=this.canvasHeight,this.barLayer={canvas:t,width:t.width,height:t.height,ctx:t.getContext("2d")};const e=this.document.createElement("canvas");e.width=this.canvasWidth,e.height=this.canvasHeight,this.textLayer={canvas:e,width:e.width,height:e.height,ctx:e.getContext("2d")}}_drawText(){let t=Math.floor(this.getTextWidth(this.textLayer.ctx,"0")/2),e=s.createText(this.textLayer.ctx,t,this.fontSize,"0",{fontSize:this.fontSize});this.barPadding.top=e.height>this.barPadding.top?e.height:this.barPadding.top;const i=this.singleSegmentPixelWH;for(let a=1;a<this.segmentNum;++a)t=i.width*a-Math.floor(this.getTextWidth(this.textLayer.ctx,this.scaleValue*a)/2),e=s.createText(this.textLayer.ctx,t,this.fontSize,this.scaleValue*a,{fontSize:this.fontSize}),this.barPadding.top=e.height>this.barPadding.top?e.height:this.barPadding.top;t=i.width*this.segmentNum-Math.floor(this.getTextWidth(this.textLayer.ctx,this.scaleValue*this.segmentNum+this.unit)/2),e=s.createText(this.textLayer.ctx,t,this.fontSize,this.scaleValue*this.segmentNum+this.unit,{fontSize:this.fontSize}),this.barPadding.top=e.height>this.barPadding.top?e.height:this.barPadding.top}getTextWidth(t,e){return t.measureText(e).width}_addTextToCanvas(){this.ctx.drawImage(this.textLayer.canvas,0,0,this.textLayer.width,this.textLayer.height,0,0,this.canvasWidth,this.canvasHeight)}_drawBar(){for(let t=0;t<this.segmentNum;++t){const e=this.singleSegmentPixelWH;t%2==0?this._drawSingleFillBar(this.barLayer.ctx,e.width*t,0+this.barPadding.top,e.width,e.height,"black"):this._drawSingleStrokeBar(this.barLayer.ctx,e.width*t,0+this.barPadding.top,e.width,e.height,"black")}}_addBarToCanvas(){this.ctx.drawImage(this.barLayer.canvas,0,0,this.barLayer.width,this.barLayer.height,0,0,this.canvasWidth,this.canvasHeight)}_drawSingleFillBar(t,e,i,a,n,s="red"){t.save(),t.fillStyle=s,t.fillRect(e,i,a,n),t.restore()}_drawSingleStrokeBar(t,e,i,a,n,s="red"){t.save(),t.strokeStyle=s;const h=Math.ceil(192/this.dpi);t.lineWidth=h,t.moveTo(e,i+h/2),t.lineTo(e+a,i+h/2),t.lineTo(e+a,i+n-h/2),t.lineTo(e,i+n-h/2),t.closePath(),t.stroke(),t.restore()}getCanvas(){return this.canvas}}},function(t,e,i){"use strict";t.exports={calculateWH(t,e,i){const a=Math.floor(t*e/2.54*i);let n=10;return n=Math.floor(n*t/96*i),{width:a,height:n}},calculateVal:(t,e)=>e*t/96}},function(t,e,i){"use strict";t.exports={adjustScaleValue:t=>t/100<1?t:t/100<1e3?100*Math.round(t/100):1e5*Math.round(t/1e5),cmUnit(t){const e={value:t,unit:"cm"};return t>100&&t<1e5?(e.value=t/100,e.unit="m"):(e.value=t/1e5,e.unit="km"),e}}},function(t,e,i){"use strict";t.exports={createText(t,e,i,a,{fontSize:n=12,fontFamily:s="Arial",fontColor:h="black"}={}){t.fillStyle=h,t.font=`${n}px ${s}`;const o={height:n,width:0},r=Math.ceil(t.measureText(a).width);return o.width=r,t.fillText(a,e,i),o}}},function(t,e,i){"use strict";t.exports=class{constructor(){if("undefined"!=typeof document&&"undefined"!=typeof window)document instanceof("undefined"!=typeof HTMLDocument?HTMLDocument:Document)?this.document=document:this.document=document.implementation.createHTMLDocument(""),this.window=window;else{const t=new(i(5).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E")).window;this.document=t.document,this.window=t}}}},function(e,i){e.exports=t}])}));